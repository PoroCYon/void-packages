# Template file for 'cross-msp430-gdb'
pkgname=cross-msp430-none-elf-gdb
version=11.1
revision=2
wrksrc=gdb-${version}
build_style=gnu-configure
configure_args="--target=msp430-none-elf --disable-werror --disable-nls --with-system-readline
 --with-system-gdbinit=/etc/gdb/gdbinit --with-system-zlib --without-isl
 $(vopt_with guile) $(vopt_if python --with-python=/usr/bin/python3)"
# --program-prefix=msp430-"
hostmakedepends="pkg-config texinfo $(vopt_if python python3-devel) $(vopt_if guile guile)"
# mpfr is necessary to emulate target floating point behavior
# babeltrace is necessary for Common Trace Format support
makedepends="expat-devel ncurses-devel readline-devel zlib-devel gmp-devel
 babeltrace-devel mpfr-devel
 $(vopt_if guile guile-devel) $(vopt_if python 'gettext-devel python3-devel')"
depends="gdb-common"
short_desc="GNU Debugger for MSP430"
maintainer="PoroCYon <porocyon@titandemo.org>"
license="GPL-3.0-or-later"
homepage="https://www.gnu.org/software/gdb"
distfiles="${GNU_SITE}/gdb/gdb-${version}.tar.xz"
checksum=cccfcc407b20d343fb320d4a9a2110776dd3165118ffd41f4b1b162340333f94
make_check=no  # See gdb/template.
patch_args="-Np1"

if [ "${CROSS_BUILD}" ]; then
	# Make python3.x detection work in cross builds
	CPPFLAGS="-I${XBPS_CROSS_BASE}/${py3_inc}"
fi

# Package build options
build_options="guile python"
build_options_default="python"

post_install() {
	# resolve conflicts with gdb-common
	rm -r ${DESTDIR}/usr/{share/{gdb,info},include}

	for x in gdb; do
		ln -s -T "msp430-none-elf-$x" "${DESTDIR}/usr/bin/msp430-$x"
	done
}
