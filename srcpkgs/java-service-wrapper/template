# Template file for 'java-service-wrapper'
pkgname=java-service-wrapper
version=3.5.45
revision=1
wrksrc=wrapper_${version}_src
#create_wrksrc=yes
only_for_archs="i686 x86_64"
#build_style=gnu-configure
#configure_args=""
#make_build_args=""
#make_install_args=""
#conf_files=""
#make_dirs="/var/log/dir 0755 root root"
hostmakedepends="openjdk apache-ant"
depends="virtual?java-runtime"
short_desc="Enables a Java Application to be run as a Unix Daemon"
maintainer="PoroCYon <porocyon@titandemo.org>"
license="custom"
homepage="https://wrapper.tanukisoftware.com/doc/english/introduction.html"
distfiles="https://wrapper.tanukisoftware.com/download/${version}/wrapper_${version}_src.tar.gz"
checksum=ae7965a1ad0389c593d5194fdaccc3bc120dbd3e7f459d7b18e6ab533bd7d402

pre_build() {
	sed -i "build.xml" \
        -e "s:value=\"1.4\":value=\"1.7\":"

	sed -i "src/c/Makefile-linux-x86"*.make \
        -e "s|all: .*|all: init wrapper libwrapper.so|"
}

do_build() {
	source /etc/profile.d/apache-ant.sh
	source /etc/profile.d/10_openjdk8.sh
	export JAVA_HOME="${JAVA_HOME:-/usr/lib/jvm/default}/.."
	#export JAVA_HOME=/usr/lib/jvm/openjdk

	[ "$XBPS_MACHINE" = "x86_64" ] && _bits=64    || _bits=32
	[ "$XBPS_MACHINE" = arm*     ] && _arch=armhf || _arch=x86

	ant -Dbits=${_bits} -Ddist.arch=${_arch} jar compile-c-unix
}

do_install() {
	vbin bin/wrapper java-service-wrapper
	vinstall lib/libwrapper.so 644 "usr/lib/java-service-wrapper/"
	vinstall lib/wrapper.jar 644 "usr/share/java/" "wrapper-${version}.jar"

	vlicense "doc/wrapper-community-license-1.3.txt"

	vinstall lib/wrapper.jar 644 "usr/share/java/"
}

